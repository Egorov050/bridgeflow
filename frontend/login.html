<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BridgeFlow — Вход</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'DM Sans',sans-serif; background:#0d0f14; color:#e8eaf2; min-height:100vh; display:flex; align-items:center; justify-content:center; }
  .logo { font-family:'Syne',sans-serif; font-size:32px; font-weight:800; text-align:center; margin-bottom:32px; }
  .logo span { color:#4f7cff; }
  .card { width:400px; background:#161920; border:1px solid #2a2f3f; border-radius:16px; padding:32px; }
  .tabs { display:flex; gap:0; margin-bottom:24px; background:#0d0f14; border-radius:10px; padding:4px; }
  .tab { flex:1; padding:9px; border:none; border-radius:8px; font-family:'DM Sans',sans-serif; font-size:14px; cursor:pointer; transition:all 0.15s; }
  .tab.active { background:#4f7cff; color:white; }
  .tab.inactive { background:transparent; color:#6b718a; }
  .form-group { margin-bottom:16px; }
  .form-label { font-size:13px; color:#6b718a; margin-bottom:6px; display:block; }
  .form-input { width:100%; background:#0d0f14; border:1px solid #2a2f3f; border-radius:10px; padding:11px 14px; color:#e8eaf2; font-family:'DM Sans',sans-serif; font-size:14px; outline:none; transition:border-color 0.15s; }
  .form-input:focus { border-color:#4f7cff; }
  .btn { width:100%; padding:12px; background:#4f7cff; color:white; border:none; border-radius:10px; font-family:'DM Sans',sans-serif; font-size:15px; font-weight:500; cursor:pointer; transition:background 0.15s; margin-top:8px; }
  .btn:hover { background:#3d6aff; }
  .error { color:#ff4f6d; font-size:13px; margin-bottom:12px; display:none; }
</style>
</head>
<body>
<div>
  <div class="logo">Bridge<span>Flow</span></div>
  <div class="card">
    <div class="tabs">
      <button class="tab active" id="tab-login" onclick="switchTab('login')">Войти</button>
      <button class="tab inactive" id="tab-register" onclick="switchTab('register')">Регистрация</button>
    </div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input class="form-input" id="auth-email" type="email" placeholder="you@company.ru">
    </div>
    <div class="form-group">
      <label class="form-label">Пароль</label>
      <input class="form-input" id="auth-password" type="password" placeholder="••••••••">
    </div>
    <div class="error" id="auth-error"></div>
    <button class="btn" onclick="submitAuth()" id="auth-btn">Войти</button>
  </div>
</div>

<script>
const API = 'https://bridgeflow.onrender.com';
let currentTab = 'login';

function switchTab(tab) {
  currentTab = tab;
  document.getElementById('tab-login').className = 'tab ' + (tab === 'login' ? 'active' : 'inactive');
  document.getElementById('tab-register').className = 'tab ' + (tab === 'register' ? 'active' : 'inactive');
  document.getElementById('auth-btn').textContent = tab === 'login' ? 'Войти' : 'Зарегистрироваться';
}

async function submitAuth() {
  const email = document.getElementById('auth-email').value;
  const password = document.getElementById('auth-password').value;
  const errorEl = document.getElementById('auth-error');
  errorEl.style.display = 'none';

  if (!email || !password) {
    errorEl.textContent = 'Заполни все поля';
    errorEl.style.display = 'block';
    return;
  }

  const endpoint = currentTab === 'login' ? '/api/auth/login' : '/api/auth/register';

  try {
    const resp = await fetch(`${API}${endpoint}`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({email, password})
    });
    const data = await resp.json();

    if (resp.ok) {
      localStorage.setItem('user', JSON.stringify(data));
      window.location.href = '/app';
    } else {
      errorEl.textContent = data.detail || 'Ошибка';
      errorEl.style.display = 'block';
    }
  } catch(e) {
    errorEl.textContent = 'Ошибка соединения';
    errorEl.style.display = 'block';
  }
}

document.addEventListener('keydown', e => {
  if (e.key === 'Enter') submitAuth();
});

// Если уже залогинен — редирект
if (localStorage.getItem('user')) {
  window.location.href = '/app';
}
</script>
</body>
</html>