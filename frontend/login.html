<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BridgeFlow ‚Äî –í—Ö–æ–¥</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'DM Sans',sans-serif; background:#0d0f14; color:#e8eaf2; min-height:100vh; display:flex; align-items:center; justify-content:center; }
  .logo { font-family:'Syne',sans-serif; font-size:32px; font-weight:800; text-align:center; margin-bottom:32px; }
  .logo span { color:#4f7cff; }
  .card { width:400px; background:#161920; border:1px solid #2a2f3f; border-radius:16px; padding:32px; }
  .tabs { display:flex; gap:0; margin-bottom:24px; background:#0d0f14; border-radius:10px; padding:4px; }
  .tab { flex:1; padding:9px; border:none; border-radius:8px; font-family:'DM Sans',sans-serif; font-size:14px; cursor:pointer; transition:all 0.15s; }
  .tab.active { background:#4f7cff; color:white; }
  .tab.inactive { background:transparent; color:#6b718a; }
  .form-group { margin-bottom:16px; }
  .form-label { font-size:13px; color:#6b718a; margin-bottom:6px; display:block; }
  .form-input { width:100%; background:#0d0f14; border:1px solid #2a2f3f; border-radius:10px; padding:11px 14px; color:#e8eaf2; font-family:'DM Sans',sans-serif; font-size:14px; outline:none; transition:border-color 0.15s; }
  .form-input:focus { border-color:#4f7cff; }
  .btn { width:100%; padding:12px; background:#4f7cff; color:white; border:none; border-radius:10px; font-family:'DM Sans',sans-serif; font-size:15px; font-weight:500; cursor:pointer; transition:background 0.15s; margin-top:8px; }
  .btn:hover { background:#3d6aff; }
  .error { color:#ff4f6d; font-size:13px; margin-bottom:12px; display:none; }
</style>
</head>
<body>
<div>
  <div class="logo">Bridge<span>Flow</span></div>
  <div class="card">
    <div class="tabs">
      <button class="tab active" id="tab-login" onclick="switchTab('login')">–í–æ–π—Ç–∏</button>
      <button class="tab inactive" id="tab-register" onclick="switchTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input class="form-input" id="auth-email" type="email" placeholder="you@company.ru">
    </div>
    <div class="form-group">
      <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
      <input class="form-input" id="auth-password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    </div>
    <div class="error" id="auth-error"></div>
    <button class="btn" onclick="submitAuth()" id="auth-btn">–í–æ–π—Ç–∏</button>
  </div>
</div>

<script>
const API = 'https://bridgeflow.onrender.com';
let currentTab = 'login';

function switchTab(tab) {
  currentTab = tab;
  document.getElementById('tab-login').className = 'tab ' + (tab === 'login' ? 'active' : 'inactive');
  document.getElementById('tab-register').className = 'tab ' + (tab === 'register' ? 'active' : 'inactive');
  document.getElementById('auth-btn').textContent = tab === 'login' ? '–í–æ–π—Ç–∏' : '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
}

async function submitAuth() {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    const errorEl = document.getElementById('auth-error');
    errorEl.style.display = 'none';
  
    if (!email || !password) {
      errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è';
      errorEl.style.display = 'block';
      return;
    }
  
    const endpoint = currentTab === 'login' ? '/api/auth/login' : '/api/auth/register';
  
    try {
      const resp = await fetch(`${API}${endpoint}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await resp.json();
  
      if (resp.ok) {
        localStorage.setItem('user', JSON.stringify(data));
        if (currentTab === 'register') {
          showOnboarding();
        } else {
            localStorage.setItem('currentScreen', 'dashboard');
            localStorage.removeItem('currentStep');
            window.location.href = '/app';
        }
      } else {
        errorEl.textContent = data.detail || '–û—à–∏–±–∫–∞';
        errorEl.style.display = 'block';
      }
    } catch(e) {
      errorEl.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
      errorEl.style.display = 'block';
    }
  }

document.addEventListener('keydown', e => {
  if (e.key === 'Enter') submitAuth();
});

// –ï—Å–ª–∏ —É–∂–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç
if (localStorage.getItem('user')) {
  window.location.href = '/app';
}

let selectedSize = '';

function selectSize(el, size) {
  document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedSize = size;
}

function showOnboarding() {
  const overlay = document.getElementById('onboarding-overlay');
  overlay.style.display = 'flex';
}

async function submitOnboarding() {
    const field = document.getElementById('ob-field').value;
    const position = document.getElementById('ob-position').value;
  
    if (!field || !position || !selectedSize) {
      alert('–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è');
      return;
    }
  
    const user = JSON.parse(localStorage.getItem('user') || '{}');
    await fetch(`https://bridgeflow.onrender.com/api/auth/onboarding/${user.user_id}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        company_field: field,
        position: position,
        company_size: selectedSize
      })
    });
  
    localStorage.setItem('currentScreen', 'dashboard');  // —Å–Ω–∞—á–∞–ª–∞
    localStorage.removeItem('currentStep');               // –ø–æ—Ç–æ–º
    window.location.href = '/app';                        // –≤ –∫–æ–Ω—Ü–µ
  }
</script>
<!-- ONBOARDING POPUP -->
<div id="onboarding-overlay" style="
  display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);
  z-index:2000;display:none;align-items:center;justify-content:center;
">
  <div style="background:#161920;border:1px solid #2a2f3f;border-radius:20px;padding:40px;width:480px;">
    <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:700;margin-bottom:8px;">
      –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ üëã
    </div>
    <div style="color:#6b718a;font-size:14px;margin-bottom:32px;">
      –ü–æ–º–æ–∂–µ—Ç –Ω–∞–º —Å–¥–µ–ª–∞—Ç—å BridgeFlow –ª—É—á—à–µ –¥–ª—è —Ç–µ–±—è
    </div>

    <div class="form-group">
      <label class="form-label">–°—Ñ–µ—Ä–∞ –∫–æ–º–ø–∞–Ω–∏–∏</label>
      <select class="form-input" id="ob-field" style="cursor:pointer;">
        <option value="">–í—ã–±–µ—Ä–∏ —Å—Ñ–µ—Ä—É</option>
        <option>–ü—Ä–æ–¥–∞–∂–∏ –∏ CRM</option>
        <option>IT –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</option>
        <option>–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
        <option>–õ–æ–≥–∏—Å—Ç–∏–∫–∞</option>
        <option>–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</option>
        <option>–§–∏–Ω–∞–Ω—Å—ã</option>
        <option>HR</option>
        <option>–î—Ä—É–≥–æ–µ</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">–¢–≤–æ—è –¥–æ–ª–∂–Ω–æ—Å—Ç—å</label>
      <select class="form-input" id="ob-position" style="cursor:pointer;">
        <option value="">–í—ã–±–µ—Ä–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç—å</option>
        <option>–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å / CEO</option>
        <option>–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</option>
        <option>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫</option>
        <option>–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥</option>
        <option>–ê–Ω–∞–ª–∏—Ç–∏–∫</option>
        <option>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã</option>
        <option>–î—Ä—É–≥–æ–µ</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">–†–∞–∑–º–µ—Ä –∫–æ–º–ø–∞–Ω–∏–∏</label>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;">
        <div class="size-btn" onclick="selectSize(this,'1-10')">1‚Äì10</div>
        <div class="size-btn" onclick="selectSize(this,'11-50')">11‚Äì50</div>
        <div class="size-btn" onclick="selectSize(this,'51-200')">51‚Äì200</div>
        <div class="size-btn" onclick="selectSize(this,'200+')">200+</div>
      </div>
    </div>

    <button class="btn btn-primary" style="width:100%;justify-content:center;margin-top:24px;" onclick="submitOnboarding()">
      –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É ‚Üí
    </button>
  </div>
</div>

<style>
.size-btn {
  background: #1e2230;
  border: 2px solid #2a2f3f;
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.15s;
}
.size-btn:hover { border-color: #4f7cff; }
.size-btn.selected { border-color: #4f7cff; background: rgba(79,124,255,0.1); color: #4f7cff; }
</style>
</body>
</html>